{% extends "master.html" %}

{% block content %}
<h2>Task {{ vm.code }}</h2>
<br/>
<div class="mb-3">
    <label for="subject">Subject</label>
    <input class="form-control" id="subject" name="subject" required="" size="255" type="text" value="{{ vm.subject }}" readonly />          
</div>    
<div class="mb-3">
    <label for="due_date">Due Date</label>
    <input class="form-control" id="due_date" name="due_date" required="" type="text" value="{{ vm.due_date.strftime('%Y-%m-%d') }}" readonly />
</div>
<div class="mb-3">
    <label for="status">Status</label>
    <input class="form-control" id="status" name="status" required="" type="text" value="{{ "Pending" if vm.status == 0 else "In Progress" if vm.status == 1 else "Completed" if vm.status == 2 else "Cancelled" }}" readonly />
</div>
<div class="mb-3">
    <label for="priority">Priority</label>
    <input class="form-control" id="priority" name="priority" required="" type="text" value="{{ "Normal" if vm.priority == 1 else "High" if vm.priority == 2 else "Low" }}" readonly />
</div>
<div class="mb-3">
    <label for="progress">Progress</label>
    <input class="form-control" id="progress" name="progress" required="" type="text" value="{{ "%.2f" % ((vm.progress|default(0))) }}" readonly />
</div>
<div class="mb-3">
    <label for="notes">Notes</label>
    <textarea class="form-control" id="notes" name="notes" required="" rows="4">{{ vm.notes }}</textarea>
</div>
<div>
        <button id="goBackButton" class="btn btn-secondary" type="button" value="Go Back"><i class="bi bi-arrow-left"></i> Go Back</button>
        {% if vm.status == 0 or vm.status == 1 %}
        <button id="editButton" class="btn btn-primary" type="button" value="Edit Task"><i class="bi bi-pencil"></i> Edit Notes</button>
        <button id="completeButton" class="btn btn-success" type="button" value="Complete Task" data-bs-toggle="modal" data-bs-target="#completeModal"><i class="bi bi-check2-circle"></i> Complete Task</button>
        <button id="reportProgressButton" class="btn btn-secondary" type="button" value="Report Progress"><i class="bi bi-bar-chart"></i> Report Progress</button>
        <button id="promoteButton" class="btn btn-secondary" type="button" value="Promote Task" data-bs-toggle="modal" data-bs-target="#promoteModal"><i class="bi bi-arrow-up-circle"></i> Promote</button>
        <button id="demoteButton" class="btn btn-secondary" type="button" value="Demote Task" data-bs-toggle="modal" data-bs-target="#demoteModal"><i class="bi bi-arrow-down-circle"></i> Demote</button>
        <button id="snoozeButton" class="btn btn-secondary" type="button" value="Snooze Task"><i class="bi bi-alarm"></i> Snooze</button>  
        <button id="deleteButton" class="btn btn-danger" type="button" value="Cancel" data-bs-toggle="modal" data-bs-target="#cancelModal"><i class="bi bi-trash"></i> Cancel</button>
        {% endif %}
</div>

<div class="modal fade" id="completeModal" tabindex="-1" aria-labelledby="completeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="completeModalLabel">Complete Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                This will mark the task as completed. Are you sure you want to continue?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                <form id="completeForm" method="post" action="{{ url_for('task_complete', task_id=vm.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-success">Yes</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="promoteModal" tabindex="-1" aria-labelledby="promoteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="promoteModalLabel">Promote Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if vm.priority == 0 %}
                This will promote the task to a <b>Normal</b> priority.
                {% elif vm.priority == 1 %}
                This will promote the task to a <b>High</b> priority.
                {% else %}
                This task is already at the highest priority.
                {% endif %}
                Are you sure you want to continue?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                <form id="promoteForm" method="post" action="{{ url_for('task_promote', task_id=vm.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-success">Yes</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="demoteModal" tabindex="-1" aria-labelledby="demoteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="demoteModalLabel">Demote Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if vm.priority == 1 %}
                This will demote the task to a <b>Low</b> priority.
                {% elif vm.priority == 2 %}
                This will demote the task to a <b>Normal</b> priority.
                {% else %}
                This task is already at the lowest priority.
                {% endif %}
                Are you sure you want to continue?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                <form id="demoteForm" method="post" action="{{ url_for('task_demote', task_id=vm.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-success">Yes</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cancelModalLabel">Cancel Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                This will mark the task as cancelled. Are you sure you want to continue?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                <form id="cancelForm" method="post" action="{{ url_for('task_cancel', task_id=vm.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-success">Yes</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="reportProgressModal" tabindex="-1" aria-labelledby="reportProgressModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reportProgressModalLabel">Report Progress</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <label for="progressInput">Progress (%)</label>
                <input type="number" class="form-control" id="progressInput" name="progress" min="0" max="100" step="5.00" value="{{ (vm.progress)|round(2) if vm.progress is not none else 0 }}">
                <small class="form-text text-muted">Enter a value between 0 and 100.</small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="reportProgressForm" method="post" action="{{ url_for('task_report_progress', task_id=vm.id) }}" style="display:inline;">
                    <input type="hidden" name="progress" id="hiddenProgressInput">
                    <button type="submit" class="btn btn-success">Save Progress</button>
                </form>
            </div>
        </div>
    </div>
</div>
<br/>
{% endblock %} 

{% block scripts %}
<script type="text/javascript">
    document.getElementById("goBackButton").onclick = function() {
        window.location.href = "{{ url_for('task_index') }}";
    };
    document.getElementById("editButton").onclick = function() {
        window.location.href = "{{ url_for('task_edit', task_id=vm.id) }}";
    };
    document.getElementById("reportProgressButton").onclick = function() {
        var modal = new bootstrap.Modal(document.getElementById('reportProgressModal'));
        modal.show();
    };
    // Copy value from visible input to hidden input on submit
    document.getElementById("reportProgressForm").onsubmit = function(e) {
        var progressValue = document.getElementById("progressInput").value;
        document.getElementById("hiddenProgressInput").value = progressValue;
    };
    document.getElementById("snoozeButton").onclick = function() {
        alert("Not implemented yet.");
    };
</script>
{% endblock %}